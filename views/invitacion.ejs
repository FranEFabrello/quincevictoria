<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis 15 Años - Te invito a mi noche mágica</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <link rel="preload" as="image" href="/assets/fondo.png">
    <link rel="preload" as="image" href="/assets/arbol.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <style>

        /* Fuente cargada por <link>, se quita el @import para evitar bloqueo adicional */
        :root {
            --font-titles: 'Playfair Display', serif;
            --font-text: 'Lato', sans-serif;
            --color-primary: #a7c7e7;
            --color-bg: #fdfdfd;
            --color-dark: #444;
            --color-light: #fff;
        }

        /* ================================================================ */
        /* == ESTILOS PARA MANTENER EL DISEÑO MÓVIL Y CENTRADO EN PC == */
        /* ================================================================ */

        body {
            /* Le damos un fondo al espacio que sobrará en pantallas grandes */
            background-color: #364b6e; /* Un color oscuro que combine */
            display: flex;
            justify-content: center;
            font-family: var(--font-text);
            margin: 0;
            padding: 0;
            color: var(--color-dark);
            text-align: center;
        }

        .mobile-container {
            width: 100%;
            max-width: 430px; /* Ancho máximo similar a un iPhone 13/14 Pro Max. */
            margin: 0 auto; /* Centra el contenedor horizontalmente */
            position: relative; /* Clave para que los elementos internos se posicionen correctamente */
            overflow-x: hidden; /* Evita cualquier desbordamiento horizontal */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); /* Sombra para darle profundidad */
            background-color: var(--color-bg, #fdfdfd); /* Fondo por defecto para el contenedor */
        }


        /* ================================== */
        /* == ESTILOS ORIGINALES AJUSTADOS == */
        /* ================================== */

        .hero h1, .hero p,
        .section h2, .section p,
        #countdown>div span, #countdown>div small {
            color: var(--color-light);
        }

        #parallax-container {
            position: fixed;   /* fijado al viewport */
            top: 0; left: 0;
            width: 100vw;      /* ancho completo de ventana */
            height: 100vh;     /* alto completo de ventana */
            z-index: 0;        /* o el valor que necesites para que quede atrás */
            overflow: hidden;
        }

        .parallax-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-position: center top;
            background-repeat: no-repeat;
            background-size: cover;
            background-image: var(--, none);
            transition: background-position 0.3s;
            z-index: 0;
        }

        #content-wrapper {
            position: relative;
            z-index: 2;
            background-color: transparent;
        }

        #leaves-container {
            position: fixed; /* 'fixed' para que cubra toda la pantalla, incluso al hacer scroll */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Muy importante para poder hacer clic en el contenido de abajo */
            z-index: 1; /* Un z-index alto para estar por encima del contenido (z-index: 2) pero por debajo del botón de música (z-index: 999) */
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }

        .hero {
            position: relative;
            height: 100vh;
            width: 100%;
            background-image: var(--, none);
            background-repeat: no-repeat;
            background-position: center top;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ===== INICIO DE CAMBIOS Y CORRECCIONES ===== */

        .hero-box {
            padding: 1.1em 0.7em;
            max-width: 100%; /* Ajustado de 94vw a 100% */
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* CORRECCIÓN: Posicionamos el título de forma estable */
            padding-top: 20vh !important;
        }

        .hero-box h1 {
            color: #70A0C8;
            font-size: clamp(2.4em, 8vw, 4em);
            font-family: var(--font-titles);
            letter-spacing: 0.05em;
            margin-bottom: 0.12em;
        }

        .hero-box p {
            color: #364b6e;
            margin: 0.12em 0;
            line-height: 1.18;
            font-size: 1.1em;
        }

        .arbusto-section {
            width: 100%; /* Ajustado de 100vw */
            min-width: 100%;
            aspect-ratio: 4911 / 3099;
            background-image: var(--, none);
            background-repeat: no-repeat;
            background-position: center bottom;
            background-size: cover;
            display: block;
            position: relative;
            /* CORRECCIÓN: Usamos % en lugar de vw para el solapamiento */
            margin-top: -55% !important; /* Ajusta este valor si es necesario */
            z-index: 10;
            overflow: visible;
            border: none;
            background-color: transparent;
        }

        .arbusto2-section, .arbusto3-section {
            width: 100%; /* Ajustado de 100vw */
            min-width: 100%;
            height: 175px;
            background-image: var(--, none);
            background-repeat: no-repeat;
            background-position: center bottom;
            background-size: cover;
            display: block;
            position: relative;
            margin-top: -5vh;
            z-index: 10;
            overflow: visible;
            border: none;
            background-color: transparent;
        }



        .arbusto-felino2 {
            width: 100%; /* Ajustado de 100vw */
            min-width: 100%;
            height: 330px;
            background-image: var(--, none);
            background-repeat: no-repeat;
            background-position: center bottom;
            background-size: cover;
            display: block;
            position: relative;
            margin-top: -19vh;
            z-index: 100;
            overflow: visible;
            border: none;
            background-color: transparent;
        }

        .arbusto-felino3 {
            width: 100%; /* Ajustado de 100vw */
            min-width: 100%;
            height: 300px;
            background-image: var(--, none);
            background-repeat: no-repeat;
            background-position: center bottom;
            background-size: cover;
            display: block;
            position: relative;
            z-index: 100;
            overflow: visible;
            border: none;
            margin-top: -8vh;
            background-color: transparent;
        }

        .section {
            padding: 35px 20px;
            margin: 20px 0;
            width: 100%;
            box-sizing: border-box;
            background: linear-gradient(to bottom,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 0.1) 30%,
            rgba(0, 0, 0, 0.2) 100%);
            backdrop-filter: blur(5px);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .section-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .countdown-section {
            position: relative;
            padding: 18px 20px 34px 20px;
            margin: -12px auto 20px auto;
            border-radius: 18px;
            max-width: 700px;
            box-shadow: 0 4px 18px rgba(80, 90, 100, 0.07);
            background: rgba(255, 255, 255, 0.13);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.11);
            -webkit-mask-image: -webkit-linear-gradient(top, transparent 0%, black 8%, black 92%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 8%, black 92%, transparent 100%);
            z-index: 2;
        }

        #countdown {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 18px;
            padding: 0 5vw;
            flex-wrap: nowrap; /* Evita que los bloques se apilen */
            overflow-x: auto;  /* Permite scroll horizontal si no entran */
        }

        #countdown>div {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(7px);
            padding: 13px 5px 8px 5px;
            border-radius: 16px;
            margin: 0;
            box-shadow: 0 2px 8px rgba(100, 120, 130, 0.09);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            flex-grow: 1;
            flex-basis: 60px;
            max-width: 80px;
        }

        #countdown span {
            display: block;
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 2px;
            letter-spacing: 1px;
        }

        #countdown small {
            font-size: 0.85em;
            margin-top: 2px;
            font-weight: 300;
        }

        #music-player {
            position: fixed; /* Ajustado de 'fixed' a 'absolute' */
            top: 20px;
            right: 20px;
            z-index: 999;
        }

        #music-toggle {
            background: var(--color-primary);
            color: var(--color-light);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .card {
            margin: auto;
            background-color: rgb(137, 168, 198);
            backdrop-filter: blur(8px);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            color: var(--color-dark);
        }

        .card .alert {
            background: rgba(255, 255, 255, 0.65);
            border: 1px solid rgba(112, 160, 200, 0.55);
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 20px;
            color: #2f3d5c;
            font-weight: 500;
            line-height: 1.4;
        }

        .card .alert-success {
            background: rgba(112, 160, 200, 0.18);
            border-color: rgba(66, 116, 155, 0.45);
            color: #1f3c5c;
        }

        .card .alert-info {
            background: rgba(255, 255, 255, 0.55);
        }

        .card .respuesta-resumen {
            background: rgba(255, 255, 255, 0.55);
            border-radius: 12px;
            padding: 20px 22px;
            margin-top: 20px;
            color: #2f3d5c;
            line-height: 1.5;
        }

        .card .respuesta-resumen .nota {
            margin-top: 12px;
            font-size: 0.95em;
            opacity: 0.85;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            margin: 0 10px;
        }

        select {
            width: 80px;
            text-align: center;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            color: var(--color-dark);
        }

        button[type="submit"] {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button[type="submit"]:hover {
            background-color: #89a8c6;
        }

        .map-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 18px;
            padding: 13px 28px;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(112, 160, 200, 0.95), rgba(137, 168, 198, 0.85));
            color: var(--color-light);
            font-family: var(--font-text);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 10px 24px rgba(54, 75, 110, 0.18);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .map-button:hover,
        .map-button:focus-visible {
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(112, 160, 200, 1), rgba(137, 168, 198, 0.95));
            box-shadow: 0 14px 26px rgba(54, 75, 110, 0.25);
            outline: none;
        }

        .map-button:focus-visible {
            outline: 3px solid rgba(255, 255, 255, 0.75);
            outline-offset: 3px;
        }

        .map-button__icon,
        .map-button__launch {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.05em;
        }

        .map-note {
            margin-top: 12px;
            font-size: 0.95em;
            color: rgba(47, 61, 92, 0.85);
        }

        .map-note i {
            margin-right: 6px;
            color: rgba(112, 160, 200, 0.9);
        }

        #sticky-tree {
            width: 100%;
            max-width: 900px;
            margin: 0 auto 1.5em auto;
            display: block;
            position: relative;
            z-index: 2;
        }

        #sticky-tree img {
            width: 100%;
            height: auto;
            display: block;
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 3em;
            }
            .hero p {
                font-size: 1.3em;
            }
            #countdown span {
                font-size: 1.5em;
            }
        }

        .blur-fade {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            width: 100%; /* Ajustado de 100vw */
            min-width: 100%;
            box-sizing: border-box;
            padding: 20px 20px;
            /* CORRECCIÓN: margen problemático reseteado */
            margin-top: 15vh !important;
            box-shadow: 0 4px 18px rgba(80, 90, 100, 0.07);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            -webkit-mask-image: -webkit-linear-gradient(top, transparent 0%, black 5%, black 95%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
            z-index: 2;
            text-align: center;
            border-radius: 0;
        }

        .blur-fade-2 {
            position: relative;
            padding: 20px 20px;
            margin-top: -5vw;
            width: 100%;
            box-sizing: border-box; /* Añadido para consistencia */
            box-shadow: 0 4px 18px rgba(80, 90, 100, 0.07);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            -webkit-mask-image: -webkit-linear-gradient(top, transparent 0%, black 5%, black 95%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
            z-index: 2;
            text-align: center;
            border-radius: 0;
        }

        .blur-fade h1,
        .blur-fade p {
            margin: 0.2em 0;
        }

        .decision-buttons input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .decision-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .decision-buttons label {
            display: block;
            padding: 18px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.7);
        }

        .decision-buttons label span {
            font-size: 1.1em;
            font-weight: 500;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .decision-buttons label:hover {
            background-color: #f5f5f5;
            border-color: #ccc;
        }

        .decision-buttons input[type="radio"]:checked + span {
            font-weight: bold;
        }

        label:has(#asistencia_si:checked) {
            background-color: #e8f5e9;
            border-color: #3a7d44;
            color: #3a7d44;
        }

        label:has(#asistencia_no:checked) {
            background-color: #ffebee;
            border-color: #b71c1c;
            color: #b71c1c;
        }

        #cantidad-group {
            text-align: center;
            padding: 20px 15px;
            background-color: rgba(245, 245, 245, 0.5);
            border-radius: 8px;
            margin-top: 10px;
        }

        #cantidad-group label {
            display: block;
            margin: 0 0 15px 0;
            font-weight: 400;
            color: var(--color-dark);
        }

        @media (min-width: 500px) {
            .decision-buttons {
                flex-direction: row;
            }
        }

        .swiper {
            width: 100%;
            max-width: 500px;
            padding-bottom: 50px;
            position: relative;
        }

        .swiper-slide {
            background-position: center;
            background-size: cover;
            width: 300px;
            height: 450px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            border-radius: 12px;
        }

        .swiper-slide img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .swiper-navigation-container {
            position: absolute;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .swiper-button-next,
        .swiper-button-prev,
        .swiper-pagination {
            position: static;
            margin: 0 15px;
        }

        .swiper-button-next::after,
        .swiper-button-prev::after {
            font-size: 1.5rem;
        }

        .swiper-pagination-bullet-active {
            background-color: var(--color-primary) !important;
        }

        .swiper-button-next,
        .swiper-button-prev {
            color: var(--color-primary) !important;
        }

        /* HOJAS */

        /* --- ESTILOS PARA LAS HOJAS (VERSIÓN ACTUALIZADA) --- */

        /* Clase base con los estilos comunes para TODAS las hojas */
        .leaf {
            position: absolute;
            width: 25px;
            height: 25px;
            background-size: contain;
            background-repeat: no-repeat;
            top: -30px;
            pointer-events: none;

            /* La animación sigue siendo la misma para todas */
            animation-name: swaying-fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        /* Clases específicas para cada diseño de hoja */
        .leaf-1 {
            background-image: url('/assets/hoja1.png');
        }
        .leaf-2 {
            background-image: url('/assets/hoja2.png');
        }
        .leaf-3 {
            background-image: url('/assets/hoja3.png');
        }
        .leaf-4 {
            background-image: url('/assets/hoja4.png');
        }

        . {
            --: none;
            background-color: rgba(112, 160, 200, 0.12);
            transition: background-color 0.4s ease;
        }

        .bg-loaded {
            background-color: transparent;
        }

        /* La animación @keyframes swaying-fall que creamos antes no necesita cambios. */
        @keyframes swaying-fall {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 1;
            }
            25% {
                transform: translateY(25vh) translateX(20px) rotate(90deg);
            }
            50% {
                transform: translateY(50vh) translateX(-20px) rotate(180deg);
            }
            75% {
                transform: translateY(75vh) translateX(20px) rotate(270deg);
            }
            100% {
                transform: translateY(110vh) translateX(0) rotate(360deg);
                opacity: 0;
            }
        }

        /* Spinner para botón de bienvenida */
        #welcome-accept {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
        }
        #welcome-accept.loading { cursor: not-allowed; opacity: .6; }
        #welcome-accept .spinner { width:16px; height:16px; border:2px solid rgba(255,255,255,.45); border-top-color:#fff; border-radius:50%; animation:spin .75s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* === HOJAS (restaurado) === */
        .leaf { position:absolute; width:25px; height:25px; background-size:contain; background-repeat:no-repeat; top:-30px; pointer-events:none; animation-name:swaying-fall; animation-timing-function:linear; animation-iteration-count:infinite; }
        .leaf-1 { background-image:url('/assets/hoja1.png'); }
        .leaf-2 { background-image:url('/assets/hoja2.png'); }
        .leaf-3 { background-image:url('/assets/hoja3.png'); }
        .leaf-4 { background-image:url('/assets/hoja4.png'); }
        @keyframes swaying-fall { 0%{transform:translateY(0) translateX(0) rotate(0deg);opacity:1;}25%{transform:translateY(25vh) translateX(20px) rotate(90deg);}50%{transform:translateY(50vh) translateX(-20px) rotate(180deg);}75%{transform:translateY(75vh) translateX(20px) rotate(270deg);}100%{transform:translateY(110vh) translateX(0) rotate(360deg);opacity:0;} }
    </style>
</head>

<body>

<div class="mobile-container">




    <div id="welcome-modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(40,60,90,0.85);z-index:9999;display:flex;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:32px 24px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.18);text-align:center;max-width:90vw;min-width:300px;">
            <h2 style="color:#70A0C8;margin-bottom:0.7em;">¡Hola <%= invitado.nombre %>!</h2>
            <p style="margin:0 0 1em 0;">Preparando la experiencia...<br><small id="asset-progress" style="display:block;margin-top:6px;color:#666;">0% • 0/0</small></p>
            <button id="welcome-accept" disabled class="loading" style="margin-top:.8em;background:#70A0C8;color:#fff;padding:12px 32px;border:none;border-radius:8px;font-size:1.05em;cursor:not-allowed;">
                <span class="spinner" aria-hidden="true"></span>
                <span class="label-text">Cargando…</span>
            </button>
            <p style="margin-top:12px;font-size:.7rem;color:#7a8694;">Si tarda demasiado podrás continuar en unos segundos.</p>
        </div>
    </div>

    <div id="parallax-container">
        <div class="parallax-layer " id="parallax-bg" style="background-image: url(/assets/fondo.png);" data-bg-priority="eager"></div>
    </div>

    <div id="content-wrapper">
        <div id="music-player">
            <audio id="background-music" src="https://iswrdjaneaucntznqyjh.supabase.co/storage/v1/object/public/victoria//musica%20invitacion%203m.mp3" loop></audio>
            <button id="music-toggle" aria-label="Controlar Música"><i class="fas fa-play"></i></button>
        </div>

        <header class="hero " style="background-image: url(/assets/arbol.png);" data-bg-priority="eager">
            <div class="hero-box">
                <div class="blur-fade">
                    <h1>VICTORIA</h1>
                    <p>Te invito a celebrar</p>
                    <p>Mis 15 Años</p>
                </div>
            </div>
        </header>




        <div class="arbusto-section " style="background-image: url(/assets/felino.png);"></div>

        <main>
            <section class="section countdown-section">
                <h2>Comienza la cuenta regresiva</h2>
                <div id="countdown">
                    <div><span id="days">00</span><small>Días</small></div>
                    <div><span id="hours">00</span><small>Horas</small></div>
                    <div><span id="minutes">00</span><small>Minutos</small></div>
                    <div><span id="seconds">00</span><small>Segundos</small></div>
                </div>
            </section>

            <div class="arbusto2-section " style="background-image: url(/assets/separador.png);"></div>

            <section class="section blur-fade-2">
                <div class="section-content">
                    <h2>La Fiesta</h2>
                    <p>Tengo el agrado de invitarte <br> a la celebración de mis quince años.<br>¡Quiero que seas parte
                        de mi noche soñada!</p>
                    <p><strong>SÁBADO, 29 <br> DE NOVIEMBRE DE 2025</strong> </p>
                    <p><strong> 22:00 hs</strong></p>
                    <p><strong> Club Citricultores </strong></p>
                </div>
            </section>


            <div class="arbusto-felino2 " style="background-image: url(/assets/felino2.png);" style="transform: scaleX(-1);"></div>

            <section class="section blur-fade-2">
                <h2>Un pequeño recuerdo</h2>
                <div class="swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1613924457768-4c1f46f43d11?q=80&w=1171&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 1"></div>
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1613789599680-e95673ca7d80?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 2"></div>
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1527345925176-fbb4fd90033e?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 3"></div>
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1562346531-6fd51e998566?q=80&w=709&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 4"></div>
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1542370773-ae6d54f6748d?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 5"></div>
                        <div class="swiper-slide"><img loading="lazy" src="https://images.unsplash.com/photo-1513597607252-a125b383749a?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Foto de Victoria 6"></div>
                    </div>
                    <div class="swiper-navigation-container">
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-pagination"></div>
                        <div class="swiper-button-next"></div>
                    </div>
                </div>
            </section>

            <div class="arbusto2-section " style="background-image: url(/assets/separador.png);"></div>

            <section class="section blur-fade-2">
                <h2>Regalos</h2>
                <p>Tu presencia es el mejor regalo que puedo recibir.<br>Si deseas hacerme un obsequio, habrá un buzón disponible en la fiesta.<br><br></p>
            </section>


            <div class="arbusto-felino3 " style="background-image: url(/assets/felino3.png);" style="transform: scaleX(-1);"></div>

            <!-- Dress Code, después de "La Fiesta" -->
            <section class="section blur-fade-2">
                <div class="section-content">
                    <h2>Dress Code</h2>
                    <p>Vestimenta sugerida: <strong>Elegante</strong>.<br>¡Sentite libre de brillar y disfrutar la noche!</p>
                </div>
            </section>

            <div class="arbusto3-section " style="background-image: url(/assets/separador.png);"></div>

            <section class="section blur-fade-2">
                <div class="section-content">
                    <h2>Ubicación</h2>
                    <p><strong>Club Citricultores</strong></p>
                    <button class="map-button" type="button"
                            onclick="window.open('https://maps.app.goo.gl/3GhsnnYWK9FuTguq9', '_blank', 'noopener')">
                        <span class="map-button__icon" aria-hidden="true"><i class="fa-solid fa-map-location-dot"></i></span>
                        Ver ubicación en Google Maps
                        <span class="map-button__launch" aria-hidden="true"><i class="fa-solid fa-up-right-from-square"></i></span>
                    </button>
                    <p class="map-note"><i class="fa-solid fa-arrow-up-right-from-square" aria-hidden="true"></i> Se abrirá en una nueva pestaña.</p>
                </div>
            </section>

            <div class="arbusto3-section " style="background-image: url(/assets/separador.png);" style="transform: scaleX(-1);"></div>


            <section class="section blur-fade-2">
                <h2>Confirmar Asistencia</h2>
                <div class="card">
                    <h3>¡Hola, <%= invitado.nombre %><% if (invitado.apellido) { %> <%= invitado.apellido %><% } %>!</h3>                <p>Tu invitación es válida para <strong><%= invitado.cantidad %> persona(s)</strong>.</p>
                    <p>Por favor, confirma tu asistencia antes del 10 de Noviembre.</p>

                    <% if (alerta) { %>
                        <div class="alert <%= alerta.tipo === 'exito' ? 'alert-success' : 'alert-info' %>"><%= alerta.mensaje %></div>
                    <% } %>

                    <% if (bloquearFormulario) { %>
                        <div class="respuesta-resumen">
                            <% if (invitado.estado === 'confirmado') { %>
                                <p><strong>¡Gracias!</strong> Ya registramos que asistirán <strong><%= invitado.confirmados || 0 %></strong> persona(s).</p>
                            <% } else if (invitado.estado === 'rechazado') { %>
                                <p>Registramos que no podrán acompañarnos en la celebración.</p>
                            <% } else { %>
                                <p>Ya registramos tu respuesta para esta invitación.</p>
                            <% } %>
                            <p class="nota">Si necesitás actualizar algún dato, por favor contactá a los organizadores.</p>
                        </div>
                    <% } else { %>
                        <form action="/confirmar/<%= invitado.id %>" method="POST">

                            <div class="form-group decision-buttons">
                                <label>
                                    <input type="radio" id="asistencia_si" name="decision" value="confirmado" checked onchange="toggleCantidad(true)">
                                    <span><i class="fas fa-check"></i> Sí, asistiré</span>
                                </label>
                                <label>
                                    <input type="radio" id="asistencia_no" name="decision" value="rechazado" onchange="toggleCantidad(false)">
                                    <span><i class="fas fa-times"></i> No podré asistir</span>
                                </label>
                            </div>

                            <div id="cantidad-group" class="form-group">
                                <label for="cantidad">¿Cuántos de los <%= invitado.cantidad %> asistirán?</label>
                                <select id="cantidad" name="confirmados" required>
                                    <% for(let i = 1; i <= invitado.cantidad; i++) { %>
                                        <option value="<%= i %>"><%= i %></option>
                                    <% } %>
                                </select>
                            </div>

                            <button type="submit">Enviar Confirmación</button>
                        </form>
                    <% } %>
                </div>
            </section>


            <div class="arbusto-felino3 " style="background-image: url(/assets/felino3.png);"></div>

        </main>
    </div>

    <div id="leaves-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // ================= PRELOADER GLOBAL DE ASSETS =================
        (function(){
            const BTN = document.getElementById('welcome-accept');
            const PROG_TEXT = document.getElementById('asset-progress');
            const APPLY_TIMEOUT_MS = 15000; // Tiempo máximo antes de permitir acceso

            // Recolectar backgrounds declarados con data-bg
            const bgEls = Array.from(document.querySelectorAll('[data-bg]'));
            const bgUrls = bgEls.map(el => el.dataset.bg).filter(Boolean);

            // Hojas (usadas como background en CSS, las forzamos a precarga)
            const leafUrls = ['/assets/hoja1.png','/assets/hoja2.png','/assets/hoja3.png','/assets/hoja4.png'];

            // Imágenes del carrusel (pueden ser pesadas: si deseas excluirlas, comenta la siguiente línea)
            const swiperImgs = Array.from(document.querySelectorAll('.swiper-slide img')).map(img => img.getAttribute('src')).filter(Boolean);

            // Audio (tratado como un asset más, sólo esperamos a metadata para no demorar demasiado)
            const audio = document.getElementById('background-music');
            const audioAssetId = '__audio__';

            const allUrls = Array.from(new Set([...bgUrls, ...leafUrls, ...swiperImgs]));
            let total = allUrls.length + 1; // +1 audio
            let loaded = 0;
            let finished = false;

            function updateProgress() {
                const percent = total ? Math.round((loaded / total) * 100) : 100;
                if (PROG_TEXT) PROG_TEXT.textContent = `${percent}% • ${loaded}/${total}`;
            }

            function markLoaded(id) {
                loaded++; updateProgress();
                if (loaded >= total) enableAccess();
            }

            function applyBgOnLoad(url) {
                // Aplica el fondo a todos los elementos correspondientes inmediatamente tras carga
                bgEls.filter(el => el.dataset.bg === url).forEach(el => {
                    el.style.setProperty('--', `url('${url}')`);
                    el.classList.add('bg-loaded');
                    el.classList.remove('');
                    el.removeAttribute('data-bg');
                });
            }

            function preloadImage(url) {
                return new Promise(resolve => {
                    const img = new Image();
                    img.onload = () => { applyBgOnLoad(url); resolve(url); };
                    img.onerror = () => resolve(url);
                    img.src = url;
                }).then(() => markLoaded(url));
            }

            function preloadAll() {
                if (!allUrls.length) total = 1; // sólo audio
                updateProgress();
                allUrls.forEach(preloadImage);

                if (audio) {
                    const onAudioReady = () => { audio.removeEventListener('loadeddata', onAudioReady); markLoaded(audioAssetId); };
                    audio.addEventListener('loadeddata', onAudioReady);
                    // Forzar carga metadata
                    try { audio.load(); } catch(_) { markLoaded(audioAssetId); }
                    // Fallback si no dispara evento
                    setTimeout(() => { markLoaded(audioAssetId); }, 4000);
                } else {
                    markLoaded(audioAssetId); // no hay audio
                }

                // Fallback global
                setTimeout(() => enableAccess(true), APPLY_TIMEOUT_MS);
            }

            function enableAccess(timeoutFallback=false) {
                if (finished) return; finished = true;
                BTN.disabled = false;
                BTN.classList.remove('loading');
                BTN.style.cursor = 'pointer'; BTN.style.opacity = '1';
                const sp = BTN.querySelector('.spinner'); if (sp) sp.remove();
                const lbl = BTN.querySelector('.label-text');
                if (lbl) lbl.textContent = timeoutFallback && loaded < total ? 'Entrar (carga parcial)' : 'Aceptar';
                if (PROG_TEXT && timeoutFallback && loaded < total) PROG_TEXT.textContent += ' • Timeout';

                // Intenta inicializar el carrusel una vez que dejamos entrar
                if (typeof initSwiper === 'function') initSwiper();
            }

            preloadAll();
        })();
        // ================= FIN PRELOADER GLOBAL =================

        // Reemplazar anterior handler (aseguramos no dobleasignar)
        const welcomeBtn = document.getElementById('welcome-accept');
        const music = document.getElementById('background-music');
        const musicToggle = document.getElementById('music-toggle');
        const musicIcon = musicToggle ? musicToggle.querySelector('i') : null;

        function updateMusicIcon() {
            if (!musicIcon) return;
            const isPlaying = music && !music.paused && !music.ended;
            musicIcon.classList.remove('fa-play', 'fa-pause');
            musicIcon.classList.add(isPlaying ? 'fa-pause' : 'fa-play');
        }

        if (music) {
            ['play', 'pause', 'ended'].forEach(eventName => {
                music.addEventListener(eventName, updateMusicIcon);
            });
        }

        if (music && musicToggle) {
            musicToggle.addEventListener('click', () => {
                if (music.paused || music.ended) {
                    const playPromise = music.play();
                    if (playPromise && typeof playPromise.then === 'function') {
                        playPromise.catch(() => {});
                    }
                } else {
                    music.pause();
                }
                updateMusicIcon();
            });
        }

        updateMusicIcon();

        welcomeBtn.onclick = function() {
            if (welcomeBtn.disabled) return;
            document.getElementById('welcome-modal').style.display = 'none';
            if (music) {
                const playPromise = music.play();
                if (playPromise && typeof playPromise.then === 'function') {
                    playPromise.catch(() => {});
                }
            }
            updateMusicIcon();
        };

        // ================= CUENTA REGRESIVA =================
        (function(){
            const targetTime = new Date('2025-11-29T22:00:00-03:00').getTime(); // Ajustar zona horaria si cambia
            const dEl = document.getElementById('days');
            const hEl = document.getElementById('hours');
            const mEl = document.getElementById('minutes');
            const sEl = document.getElementById('seconds');
            if(!dEl||!hEl||!mEl||!sEl) return;
            function pad(n){ return String(n).padStart(2,'0'); }
            function tick(){
                const now = Date.now();
                let diff = targetTime - now;
                if (diff <= 0) {
                    dEl.textContent = hEl.textContent = mEl.textContent = sEl.textContent = '00';
                    return; // Evento pasado
                }
                const sec = 1000, min = sec*60, hr = min*60, day = hr*24;
                const days = Math.floor(diff/day);
                diff -= days*day;
                const hours = Math.floor(diff/hr);
                diff -= hours*hr;
                const minutes = Math.floor(diff/min);
                diff -= minutes*min;
                const seconds = Math.floor(diff/sec);
                dEl.textContent = pad(days);
                hEl.textContent = pad(hours);
                mEl.textContent = pad(minutes);
                sEl.textContent = pad(seconds);
            }
            tick();
            setInterval(tick, 1000);
        })();
        // ================= FIN CUENTA REGRESIVA =================

        // ================= SWIPER INIT (RESTAURADO) =================
        function initSwiper(){
            if (window._swiperInit) return;
            if (typeof Swiper === 'undefined') return; // aún no cargó script
            const el = document.querySelector('.swiper');
            if (!el) return;
            window._swiperInit = true;
            new Swiper('.swiper', {
                effect: 'coverflow',
                grabCursor: true,
                centeredSlides: true,
                slidesPerView: 'auto',
                coverflowEffect: { rotate: 50, stretch: 0, depth: 100, modifier: 1, slideShadows: true },
                loop: true,
                autoplay: { delay: 5000, disableOnInteraction: false },
                pagination: { el: '.swiper-pagination', clickable: true },
                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
            });
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSwiper);
        } else {
            initSwiper();
        }
        // ================= FIN SWIPER INIT =================

        // ================= HOJAS ANIMADAS (RESTAURADO) =================
        function initLeavesAnimation(){
            if (window._leavesInit) return; window._leavesInit = true;
            const container = document.getElementById('leaves-container');
            if (!container) return;
            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            const maxLeaves = prefersReduced ? 8 : (window.matchMedia('(max-width:768px)').matches ? 16 : 26);
            const leafTypes = 4;
            let active = 0;
            function removeLater(el){ setTimeout(()=>{ el.remove(); active = Math.max(active-1,0); }, 13000); }
            function createLeaf(){
                const el = document.createElement('div');
                const t = Math.floor(Math.random()*leafTypes)+1;
                el.className = `leaf leaf-${t}`;
                el.style.left = (Math.random()*100)+'vw';
                el.style.animationDuration = (Math.random()*5+8)+'s';
                el.style.animationDelay = (Math.random()*5)+'s';
                return el;
            }
            function spawn(){
                if (document.hidden) return;
                if (active >= maxLeaves) return;
                const l = createLeaf();
                container.appendChild(l); active++; removeLater(l);
            }
            const interval = prefersReduced ? 2400 : 1200;
            if (!prefersReduced){
                setInterval(spawn, interval);
                document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) spawn(); });
            }
            // seed
            for(let i=0;i<Math.min(6,maxLeaves);i++) spawn();
        }
        // ================= FIN HOJAS ANIMADAS =================

        // Hook en el botón de aceptación para iniciar hojas (si no se iniciaron antes)
        welcomeBtn.addEventListener('click', ()=>{ if(!welcomeBtn.disabled) initLeavesAnimation(); });
        // Por si el usuario ya estaba dentro (sin modal) iniciamos al cargar
        if (!document.getElementById('welcome-modal')) initLeavesAnimation();
    </script>
    <script>
        // Script para elegir assets mobile/desktop automáticamente
        (function() {
            const isMobile = window.innerWidth <= 600;
            const suffix = isMobile ? 'mobile' : 'desktop';
            // Cambia data-bg de los fondos principales
            document.querySelectorAll('[data-bg]').forEach(el => {
                let bg = el.getAttribute('data-bg');
                if (!bg) return;
                // Solo reemplaza si existe versión optimizada
                const base = bg.replace(/\.svg$/, '');
                // Intenta usar webp, si no png
                const webp = `${base}.${suffix}.webp`;
                const png = `${base}.${suffix}.png`;
                // Prueba si existe la imagen (solo para navegadores modernos)
                const testImg = new Image();
                testImg.onload = function() {
                    el.setAttribute('data-bg', webp);
                    el.style.setProperty('--', `url('${webp}')`);
                };
                testImg.onerror = function() {
                    el.setAttribute('data-bg', png);
                    el.style.setProperty('--', `url('${png}')`);
                };
                testImg.src = webp;
            });
        })();
    </script>

</div>
</body>
</html>
